# .htaccess - redirects and headers for Agnivridhi site
# Updated: November 4, 2025
# - Force HTTPS
# - Redirect www -> non-www
# - Custom error pages (404, 500)
# - Security headers and admin blocking
# - Redirect removed pages

# Custom Error Pages
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html

<IfModule mod_rewrite.c>
    RewriteEngine On

    # Redirect www.example.com -> non-www (preserve path and query)
    RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
    RewriteRule ^ https://%1%{REQUEST_URI} [L,R=301]

    # Redirect HTTP to HTTPS
    RewriteCond %{HTTPS} off
    RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

    # Block admin directory access
    RewriteRule ^admin/?$ - [F,L]
    RewriteRule ^admin/(.*)$ - [F,L]

    # Redirect removed pages
    RewriteRule ^cgtmse-eluxcart(\.html)?$ /success-stories.html [L,R=301]
    
    # 301 redirect /privacy and /privacy/ to canonical privacy-policy.html
    RewriteRule ^privacy/?$ /privacy-policy.html [L,R=301]

    # 301 redirect /consultation to contact page (site has no consultation page)
    RewriteRule ^consultation/?$ /contact.html [L,R=301]
    
    # 301 redirect /index.html or /index.htm to root (prefer clean homepage URL)
    RewriteRule ^index(\.html?|\.htm)?$ / [L,R=301,NC]
    
    # 301 redirect book-consultation.html to homepage (mask as homepage in search)
    RewriteRule ^book-consultation(\.html?)?$ / [L,R=301,NC]
</IfModule>

<IfModule mod_headers.c>
    # Apply X-Robots-Tag to any /admin/ path so crawlers know not to index
    SetEnvIf Request_URI "^/admin/" admin_path=1
    Header set X-Robots-Tag "noindex, nofollow" env=admin_path
    
    # Security headers
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
</IfModule>

# Disable directory listings for safety
Options -Indexes

# Deny access to sensitive files
<FilesMatch "^(\.htaccess|\.git|\.env|config\.php)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# End of file


